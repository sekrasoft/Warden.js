!function(a,b){"object"==typeof exports&&exports?b(exports):(null==a.Warden&&(Warden={}),b(Warden),"function"==typeof define&&define.amd?define(Warden):a.Warden=Warden)}(this,function(a){"use strict";function b(a,b){var d=a||[],e=0,f=0,g={$continue:function(a){return h.tick(a)},$break:function(){return h.tick({},1)},$lock:function(){return e=1},$unlock:function(){return e=0},$update:function(){b.update()},$host:function(){return b}},h={process:function(a){return c.is.exist(a)?d.push(a):d},start:function(a,b,c){return h.ctx=b,h.fin=c,f=e?0:f,f==d.length?(f=0,c(a)):void this.tick(a)},tick:function(a,b){return b?f=0:f==d.length?(f=0,h.fin(a)):(f++,void d[f-1].apply(h.ctx,[a,g]))}};return h}a.version="0.1.0",a.configure={};var c,d;!function(){var a="function",b="number",e="string",f="object",g="boolean";c=function(){var c=function(a){var b=[a],c=!1,d=function(a){var d=j(b,function(b){return b(a)});return c?d.every(k):d.some(k)};return d.or=function(a){return b.push(a),d},d.and=function(a){return c=!0,d.or(a)},d.butNot=function(a){return d.and(m(a))},d},d=function(a,b){return a.prototype[b]?function(c,d){a.prototype[b].call(c,d)}:!1},h=d(Array,"forEach")||function(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c],c)},i=d(Array,"filter")||function(a,b){var c=[];return h(a,function(a,d){b(a,d)===!0&&c.push(a)}),filterd},j=d(Array,"map")||function(a,b){var c=[];return h(a,function(a,d){c[d]=b(a,d)}),c},k=function(a){return a?!0:!1},l=function(a){return function(b){return typeof b===a}},m=function(a){return function(b){return!a(b)}},n={exist:function(a){return"undefined"!=typeof a&&null!==a},array:function(a){return Array.isArray(a)},fn:l(a),num:l(b),str:l(e),bool:l(g),truthy:k,falsee:m(k),equals:function(a){return function(b){return a===b}}};return n.obj=function(a){return l(f)(a)&&!n.array(a)},n.not=function(){var a={};for(var b in n)a[b]=m(n[b]);return a}(),{is:n,$let:c,forEach:h,each:h,filter:i,map:j,extend:function(){function a(b,c){var d,e,f,g,h;for(var i in c)if(c[i]&&n.obj(c[i]))b[i]=b[i]||{},a(b[i],c[i]);else if(n.array(c[i]))if(b[i]=b[i]||[],n.obj(b[i][0])&&n.obj(c[i][0]))for(h=c[i],d=f=0,g=h.length;g>f;d=++f)e=h[d],b[i][d]=a(b[i][d]||{},c[i][d]);else b[i]=c[i];else b[i]=c[i];return b}var b=Array.prototype.slice.call(arguments);return b.reduce(function(b,c){return a(b,c)})},Queue:function(a,b){var c=b||[],a=a||16,d=c.push;return c.push=function(b){return this.length>=a&&this.shift(),d.apply(c,[b])},c},$hash:function(){var a={};return{get:function(b){return a[b]},set:function(b){var c=parseInt(a[b],16)||0;return a[b]=(c+1).toString(16)}}}()}}(),d=function(a,b){{var c=d.MAP[a],e=typeof b;c[c.length-1]}if(c&&-1==c.indexOf(e))throw"TypeError: unexpected type of argument at: ."+a+"(). Expected type: "+c.join(" or ")+". Your argument is type of: "+e},d.MAP={extend:[f,a],reduce:[a],take:[a,b],filter:[a],skip:[b],setup:[a],makeStream:[e,a,f],debounce:[b],getCollected:[b],interpolate:[e],mask:[f]}}(),a.Utils=c,a.configure.exceptionManager=d,a.configure.datatypes=function(a,b){if(d.MAP[a])throw"This name is already exist";d.MAP[a]=b},a.extend=function(){var b=c.each,e=c.is,f=c.extend,g="addEventListener",h="attachEvent",i={names:{emit:"emit",listen:"listen",stream:"stream",unlisten:"unlisten"},max:512,emitter:null,listener:null};return a.configure.changeDefault=function(a){return c.extend(i,a)},a.configure.natives=function(a){g=a.listener,h=a.altenativeListener},function(c,j){d("extend",c);var k=f({},i,j||{}),l=c,m=!0,n=k.names;e.fn(c)?l=c.prototype:m=!1;var o=l[n.emit]||l[n.listen]||l[n.unlisten]||l[n.stream];if(e.exist(o))throw new Error("Can't overwrite: "+(o.name?o.name:o)+" of object");return"undefined"!=typeof jQuery?(k.emitter=k.emitter||"trigger",k.listener=k.listener||"on"):(e.fn(l[g])||e.fn(l[h]))&&(k.listener=k.listener||(e.fn(l[g])?g:h)),l[n.emit]=function(a){var c=this,d=this.$$handlers.filter(function(b){return b.type==a||b.type==a.type});return b(d,function(b){b.callback.call(c,a)}),this},l[n.listen]=function(a,b){var c=this,d=this.$$handlers=this.$$handlers||[];if(!(this.$$handlers.length<k.max))throw new Error("Maximal handlers limit reached");return!d.filter(function(b){return b.type==a}).length&&this[k.listener]&&this[k.listener].apply(this,[a,function(a){c.emit(a)}]),this.$$handlers.push({type:a,callback:b}),this},l[n.unlisten]=function(a,c){var d=this;if(d.$$handlers){var e=[];b(d.$$handlers,function(a,b){a.callback.name==(c.name||c)&&e.push(b)}),b(e,function(a){d.$$handlers.splice(a,1)})}return this},l[n.stream]=function(b,c){var d=a.makeStream(b,c||this),e=this.$$handlers=this.$$handlers||[];return!e.filter(function(a){return a.type==b}).length&&this[k.listener]&&this[k.listener].apply(this,[b,function(a){d.eval(a)}]),this.$$handlers.push({type:b,callback:function(a){d.eval(a)}}),d.get()},c}}(),a.makeStream=function(){function a(a){var d=[];return{$$id:c.$hash.set("s"),$$context:a,eval:function(c){b(d,function(b){b.fire(c,a)})},push:function(a){return d.push(a),a},pushAllUp:function(a){var c=this;b(d.push(a).children,function(a){c.pushAllUp(a)})},pop:function(a){return b(d,function(b,c){a.$$id==b.$$id&&(d=d.slice(0,c).concat(d.slice(c+1,d.length)))}),a},popAllDown:function(a){var c=this;b(c.pop(a).children,function(a){c.popAllDown(a)})},popAllUp:function(a){var b=this.pop(a);f.exist(b.parent)&&this.popAllUp(b.parent)},get:function(){var a=new e;return a.host(this),a}}}var b=c.each,f=c.is;return function(c,e,g){var h,i,j,k=[];if(d("makeStream",c),e=e||{},h=a(e),f.fn(c)){if(g===!0){i=c.toString();for(j in e)e.hasOwnProperty(j)&&k.push(j);b(k,function(a){i.indexOf("this."+a)>=0&&console.error("Coincidence: property: '"+a+"' is already defined in stream context!",e)})}c.call(e,function(a){h.eval(a)})}else f.array(c)&&b(function(){var a=[];return b(["pop","push","slice","splice","reverse","map","forEach","reduce","join","filter","concat","shift","unshift"],function(b){a.push({name:b,fun:Array.prototype[b]})}),a}(),function(a){c[a.name]=function(){a.fun.apply(c,arguments),h.eval({type:arguments.callee.name,data:arguments})}});return h}}();var e=function(){function e(a,b){a.parent=b,b.children.push(a)}function f(a){var b,c,d=j(this.$$id,"processor");return a?(b=[],h(d.process(),function(a){b.push(a)}),b.push(a),c=new g(b),c.host(this.host()),e(c,this),c):d}function g(d){var e=this,f=null;this.$$id=c.$hash.set("d");j(this.$$id,{processor:new b(d||[],e),host:0,binding:null,handlers:[],setup:function(a){return a}});this.parent=null,this.children=[],this._={fires:new c.Queue,takes:new c.Queue},this.bindTo=function(b,c,d){var e=this;return f||(f=a.watcher(e,b,c,d)),f},this.update=function(a){f&&f.update(a||this._.takes[this._.takes.length-1])}}var h=c.each,i=c.is,j=function(){var a={};return function(b,c,d){return i.exist(d)?(a[b][c]=i.fn(d)?d(a[b][c]):d,a[b][c]):a[b]&&i.exist(a[b][c])?a[b][c]:(a[b]=c,a[b])}}();return g.prototype.fire=function(a,b){var c=this.$$id,d=this,e=j(c,"handlers"),f=j(c,"processor");a=j(c,"setup")(i.exist(a)?a:{}),this._.fires.push(a),f.start(a,b,function(a){d._.takes.push(a),d.update(a),h(e,function(c){c.apply(b,[a])})})},g.prototype.setup=function(a){d("setup",a),j(this.$$id,"setup",function(){return a})},g.prototype.host=function(a){return a?j(this.$$id,"host",a):j(this.$$id,"host")},g.prototype.listen=function(a){var b=this;return j(this.$$id,"handlers",function(c){return c.push(i.fn(a)?a:function(){console.log(a)}),c.length<=1&&b.host().push(b),c}),this},g.prototype.mute=function(a){return a=i.fn(fn)?a.name:a,h(j(this.$$id,"handlers"),function(b,c){b.name==a&&j(this.$$id,"handlers",function(a){return a.slice(0,c).concat(a.slice(c+1,a.length))})}),this},g.prototype.log=function(){return this.listen(function(a){return console.log(a)})},g.prototype.filter=function(a){return d("filter",a),f.call(this,function(b,c){return a.apply(this,[b])===!0?c.$continue(b):c.$break()})},g.prototype.map=function(a){var b,c=typeof a;switch(c){case"function":b=function(b,c){return c.$continue(a.call(this,b))};break;case"string":b=function(b,c){var d=b[a],e=i.exist(d)?d:a;return c.$continue(e)};break;case"object":b=i.array(a)?function(b,c){var d=[];return h(a,function(a){var c=b[a];d.push(i.exist(c)?c:a)}),c.$continue(d)}:function(b,c){var d,e={};for(var f in a)d=b[a[f]],e[f]=i.exist(d)?d:a[f];return c.$continue(e)};break;default:b=function(b,c){return c.$continue(a)}}return f.call(this,b)},g.prototype.reduce=function(a,b){return d("reduce",b,arguments.length),f.call(this,function(c,d){var e=d.$host(),f=a,g=c;return(e._.takes.length>=1||"first"==a||"-f"==a)&&(f=e._.takes[e._.takes.length-1]),d.$continue(b.call(this,f,g))})},g.prototype.take=function(a){return d("take",a),i.fn(a)?this.filter(a):f.call(this,function(b,c){var d=c.$host();return d._.limit=d._.limit||a,d._.takes.length===d._.limit?c.$break():c.$continue(b)})},g.prototype.skip=function(a){return d("skip",a),f.call(this,function(b,c){var d=c.$host();return d._.fires.length<=a?void c.$break():c.$continue(b)})},g.prototype.interpolate=function(a,b){return d("interpolate",a),f.call(this,function(c,d){var e=b||/{{\s*[\w\.]+\s*}}/g;return d.$continue(a.replace(e,function(a){return c[a.slice(2,-2)]}))})},g.prototype.mask=function(a,b){return d("mask",a),f.call(this,function(c,d){var e=b||/{{\s*[\w\.]+\s*}}/g;return d.$continue(c.replace(e,function(b){return a[b.slice(2,-2)]}))})},g.prototype.unique=function(a){return a=i.fn(a)?a:function(a,b){return a===b},f.call(this,function(b,c){var d=c.$host()._.fires,e=c.$host()._.takes;return(d.length>1||e.length>0)&&(a(b,d[d.length-2])||a(b,e[e.length-1]))?c.$break():c.$continue(b)})},g.prototype.debounce=function(a){return d("debounce",a),f.call(this,function(b,c){var d=c.$host();clearTimeout(d._.dbtimer),d._.dbtimer=setTimeout(function(){delete d._.dbtimer,c.$unlock(),c.$continue(b)},a),c.$lock()})},g.prototype.getCollected=function(a){return d("getCollected",a),f.call(this,function(b,c){{var d=c.$host();d._.fires.length-1}d._.tmpCollection=d._.tmpCollection||[],d._.tmpCollection.push(b),d._.timer?c.$lock():(d._.timer=setTimeout(function(){var a=d._.tmpCollection;clearTimeout(d._.timer),delete d._.timer,delete d._.tmpCollection,c.$unlock(),c.$continue(a)},a),c.$lock())})},g.prototype.after=function(a,b){var c=!1;return a.listen(function(){c=!0}),f.call(this,function(a,d){c?(c=b===!0?!1:!0,d.$unlock(),d.$continue(a)):d.$lock()})},g.prototype.waitFor=function(b){var c=this;return a.makeStream(function(a){var d,e=!1,f=function(){d=null,e=!1};b.listen(function(){e&&(a(d),f())}),c.listen(function(a){d=a,e=!0})}).get()},g.prototype.merge=function(b){var c=this,d=a.makeStream(function(a){b.listen(a),c.listen(a)}).get();return d},g.prototype.resolveWith=function(b,c){var d=this,e=this.host().$$context;return a.makeStream(function(a){d.sync(b).listen(function(b){var d=b[0],f=b[1];a(c.call(e,d,f))})},e).get()},g.prototype.combine=function(b,c,d){var e,f,g=this,d=d||this.host().$$context;return b.listen(function(a){f=a}),this.listen(function(a){e=a}),a.makeStream(function(a){function h(){a(c.call(d,e,f))}g.listen(h),b.listen(h)},d).get()},g.prototype.sync=function(b){var c=this,b=a.makeStream(function(a){var d,e,f=!1,g=!1,h=function(){d=null,e=null,f=!1,g=!1};b.listen(function(b){f?(a([d,b]),h()):(e=b,g=!0)}),c.listen(function(b){g?(a([b,e]),h()):(d=b,f=!0)})}).get();return e(b,this),b},g.prototype.lock=function(){this.host().pop(this)},g.prototype.lockChildren=function(){this.host().popAllDown(this)},g.prototype.lockParent=function(){this.host().popAllUp(this)},g.prototype.unlock=function(){this.host().push(this)},a.configure.addToDatabus=function(a,b,c,e){b=b||a.name,g.prototype[b]=function(){if(d(b,arguments[e||0]),c&&c!=arguments.length)throw"Unexpected arguments count";return f.call(this,a(arguments))}},g}();a.watcher=function(){return function(a,b,d){var e,f=c.is;return!f.exist(d)&&f.exist(b)?"string"==ta||"object"==ta?e=function(a){return this[b]=a}:"function"==ta&&(e=function(a){return b(a)}):f.exist(d)&&(f.obj(b)&&f.str(d)?e=function(a){return b[d]=a}:f.obj(b)&&f.fn(d)&&(e=function(a){return d.call(b,a)})),a.listen(e),c.extend(new function(){},{update:e,unbind:function(b){a.mute(b)},bind:function(){a.listen(e||e)}})}}()});